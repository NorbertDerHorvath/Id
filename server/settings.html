<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Settings</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-dark\">\n        <a class=\"navbar-brand\" href=\"/dashboard\">Id≈ë Dashboard</a>\n        <div class=\"collapse navbar-collapse\">\n            <ul class=\"navbar-nav mr-auto\" id=\"nav-links\">\n                <li class=\"nav-item\"><a class=\"nav-link\" href=\"/dashboard\">Home</a></li>\n                <li class=\"nav-item\"><a class=\"nav-link\" href=\"/admin\">Admin</a></li>\n                <li class=\"nav-item active\"><a class=\"nav-link\" href=\"/settings\">Settings</a></li>\n            </ul>\n            <ul class=\"navbar-nav ml-auto\">\n                 <li class=\"nav-item\"><span class=\"navbar-text mr-3\">Welcome, <span id=\"username-display\"></span>!</span></li>\n                <li class=\"nav-item\"><button id=\"logout-btn\" class=\"btn btn-danger\">Logout</button></li>\n            </ul>\n        </div>\n    </nav>\n\n    <div class=\"container mt-4\">\n        <h2>Settings</h2>\n        <div id=\"settings-content\">\n            <p>Loading settings...</p>\n        </div>\n    </div>\n\n    <script src=\"https://code.jquery.com/jquery-3.5.1.min.js\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n    <script>\n    document.addEventListener(\'DOMContentLoaded\', async function() {\n        const token = localStorage.getItem(\'token\');\n        if (!token) {\n            window.location.href = \'/login.html\';\n            return;\n        }\n\n        const decodedToken = parseJwt(token);\n        if (!decodedToken) {\n            window.location.href = \'/login.html\';\n            return;\n        }\n        const userRole = decodedToken.role;\n        const isAdmin = userRole === \'admin\' || userRole === \'superadmin\';\n\n        if (!isAdmin) {\n             document.querySelector(\'a[href=\"/admin\"]\').parentElement.style.display = \'none\';\n             document.querySelector(\'a[href=\"/settings\"]\').parentElement.style.display = \'none\';\n        }\n\n        if (window.location.pathname.endsWith(\'settings.html\')) {\n            if (!isAdmin) {\n                 window.location.href = \'/dashboard\';\n                 return;\n            }\n            await loadAdminSettings();\n        }\n\n        document.getElementById(\'username-display\').textContent = localStorage.getItem(\'username\') || \'User\';\n\n        document.getElementById(\'logout-btn\').addEventListener(\'click\', () => {\n            localStorage.clear();\n            window.location.href = \'/login.html\';\n        });\n    });\n\n    function parseJwt(token) {\n        try { return JSON.parse(atob(token.split(\'.\')[1])); } catch (e) { return null; }\n    }\n\n    async function loadAdminSettings() {\n        const settingsContent = document.getElementById(\'settings-content\');\n        try {\n            const response = await fetch(\'/api/settings\', {\n                headers: { \'Authorization\': `Bearer ${localStorage.getItem(\'token\')}` }\n            });\n            if (!response.ok) throw new Error(\'Failed to load settings\');\n\n            const settings = await response.json();\n            renderSettingsForm(settings);\n        } catch (error) {\n            settingsContent.innerHTML = `<p class=\"text-danger\">Error loading settings: ${error.message}</p>`;\n        }\n    }\n\n    function renderSettingsForm(settings) {\n        const settingsContent = document.getElementById(\'settings-content\');\n        const maintenanceMode = settings.maintenance_mode === \'true\';\n\n        settingsContent.innerHTML = `\n            <form id=\"settings-form\">\n                <div class=\"form-group\">\n                    <label for=\"maintenance-mode\">Maintenance Mode</label>\n                    <select class=\"form-control\" id=\"maintenance-mode\">\n                        <option value=\"true\" ${maintenanceMode ? \'selected\' : \'\'}>Enabled</option>\n                        <option value=\"false\" ${!maintenanceMode ? \'selected\' : \'\'}>Disabled</option>\n                    </select>\n                </div>\n                 <button type=\"submit\" class=\"btn btn-primary\">Save Settings</button>\n            </form>\n        `;\n\n        document.getElementById(\'settings-form\').addEventListener(\'submit\', async function(e) {\n            e.preventDefault();\n            const newSettings = {\n                maintenance_mode: document.getElementById(\'maintenance-mode\').value\n            };\n\n            try {\n                const response = await fetch(\'/api/settings\', {\n                    method: \'POST\',\n                    headers: {\n                        \'Content-Type\': \'application/json\',\n                        \'Authorization\': `Bearer ${localStorage.getItem(\'token\')}`\n                    },\n                    body: JSON.stringify(newSettings)\n                });\n                if (!response.ok) throw new Error(\'Failed to save settings\');\n                alert(\'Settings saved successfully!\');\n            } catch (error) {\n                alert(\`Error saving settings: ${error.message}\`);\n            }\n        });\n    }\n\n</script>\n</body>\n</html>