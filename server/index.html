<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Idő - Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { font-size: 0.875rem; }
        .table-responsive { max-height: 400px; }
        th, td { white-space: nowrap; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="/dashboard">Idő Dashboard</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto" id="nav-links">
                <li class="nav-item active"><a class="nav-link" href="/dashboard">Home</a></li>
            </ul>
            <ul class="navbar-nav ml-auto">
                 <li class="nav-item"><span class="navbar-text mr-3">Welcome, <span id="username-display"></span>!</span></li>
                <li class="nav-item"><button id="logout-btn" class="btn btn-danger">Logout</button></li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div id="main-content">
             <!-- Content is rendered by JS -->
        </div>
    </div>
    
    <!-- Edit Workday Modal -->
    <div class="modal fade" id="editWorkdayModal" tabindex="-1">...</div>

    <!-- Edit Refuel Modal -->
    <div class="modal fade" id="editRefuelModal" tabindex="-1">...</div>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // ... (All the JS code from the previous steps)
        
        async function handleUpdateWorkday(e) {
            e.preventDefault();
            const eventId = document.getElementById('edit-workday-id').value;
            const body = {
                startTime: document.getElementById('edit-start-time').value,
                endTime: document.getElementById('edit-end-time').value || null,
                startLocation: document.getElementById('edit-start-location').value,
                endLocation: document.getElementById('edit-end-location').value,
                carPlate: document.getElementById('edit-car-plate').value,
                startOdometer: document.getElementById('edit-start-odo').value,
                endOdometer: document.getElementById('edit-end-odo').value,
                breakTime: document.getElementById('edit-break').value,
            };

            try {
                const res = await fetch(`/api/workday-events/${eventId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify(body)
                });
                if(!res.ok) throw new Error((await res.json()).error);
                $('#editWorkdayModal').modal('hide');
                fetchData();
            } catch(e) { alert('Error: ' + e.message); }
        }

        async function handleUpdateRefuel(e) {
            e.preventDefault();
            const eventId = document.getElementById('edit-refuel-id').value;
            const body = {
                timestamp: document.getElementById('edit-refuel-date').value,
                location: document.getElementById('edit-refuel-location').value,
                odometer: document.getElementById('edit-refuel-odo').value,
                fuelType: document.getElementById('edit-refuel-type').value,
                fuelAmount: document.getElementById('edit-refuel-amount').value,
                value: document.getElementById('edit-refuel-price').value,
                paymentMethod: document.getElementById('edit-refuel-payment').value,
            };
             try {
                const res = await fetch(`/api/refuel-events/${eventId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify(body)
                });
                if(!res.ok) throw new Error((await res.json()).error);
                $('#editRefuelModal').modal('hide');
                fetchData();
            } catch(e) { alert('Error: ' + e.message); }
        }
    </script>
</body>
</html>
